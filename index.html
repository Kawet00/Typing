<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test de vitesse d'écriture</title>
    <style>
        body {
            font-family: 'Segoe UI', Arial, sans-serif;
            max-width: 500px;
            margin: 40px auto;
            background: linear-gradient(135deg, #e0eafc 0%, #cfdef3 100%);
        }
        .main-box {
            background: #fff;
            border-radius: 18px;
            box-shadow: 0 8px 32px rgba(44, 62, 80, 0.12);
            padding: 32px 28px 28px 28px;
            margin-top: 30px;
        }
        h1 {
            text-align: center;
            font-size: 2.1em;
            font-weight: 700;
            letter-spacing: 1px;
            color: #2d3a4a;
            margin-bottom: 18px;
            animation: fadeInDown 0.8s;
        }
        @keyframes fadeInDown {
            0% { opacity: 0; transform: translateY(-30px);}
            100% { opacity: 1; transform: translateY(0);}
        }
        #timer {
            font-size: 1.1em;
            color: #4caf50;
            font-weight: bold;
            margin-bottom: 10px;
            text-align: center;
        }
        #texte {
            margin: 20px 0;
            font-size: 1.1em;
            line-height: 1.5;
            background: #f7fafd;
            border-radius: 8px;
            padding: 12px 10px;
            min-height: 48px;
            box-shadow: 0 2px 8px rgba(44, 62, 80, 0.04);
            position: relative;
        }
        #result {
            margin-top: 30px;
            background: #f7fafd;
            border-radius: 8px;
            padding: 16px 12px;
            box-shadow: 0 2px 8px rgba(44, 62, 80, 0.04);
        }
        #progress {
            margin-top: 10px;
            color: #2d3a4a;
            font-size: 0.98em;
        }
        input[type="text"] {
            margin-bottom: 10px;
            border-radius: 6px;
            border: 1.5px solid #b6c7d6;
            padding: 8px 10px;
            font-size: 1em;
            transition: border 0.2s;
            box-shadow: 0 1px 4px rgba(44, 62, 80, 0.04);
        }
        input[type="text"]:focus {
            border-color: #4caf50;
            outline: none;
        }
        .error { background: #ffb2b2; color: #a00; }
        .word { padding: 2px 4px; margin: 0 2px; border-radius: 3px; transition: background 0.2s; }
        .word.done { background: #d4ffd4; }
        .word.current { background: #ffe4b2; border-bottom: 2px solid #ff9800; font-weight: bold; }
        .word.error { background: #ffb2b2; color: #a00; border-bottom: 2px solid #a00; }
        #progress-bar {
            width: 100%;
            height: 10px;
            background: #eee;
            border-radius: 5px;
            margin-top: 10px;
            box-shadow: 0 1px 4px rgba(44, 62, 80, 0.08);
        }
        #progress-bar-inner {
            height: 100%;
            background: linear-gradient(90deg, #4caf50 60%, #81c784 100%);
            border-radius: 5px;
            width: 0;
            transition: width 0.2s;
        }
        input.error-blink {
            animation: blink 0.2s 2;
            border: 2px solid #a00;
        }
        @keyframes blink {
            0% { background: #ffb2b2; }
            100% { background: white; }
        }
        .current-char {
            font-weight: bold;
            text-decoration: underline;
            color: #333;
        }
        .word-animate {
            animation: popWord 0.3s;
        }
        @keyframes popWord {
            0% { transform: scale(1); background: #b2ffd4; }
            50% { transform: scale(1.2); background: #4caf50; }
            100% { transform: scale(1); background: #d4ffd4; }
        }
        #start {
            background: linear-gradient(90deg, #4caf50 60%, #81c784 100%);
            color: #fff;
            border: none;
            border-radius: 8px;
            padding: 10px 22px;
            font-size: 1.08em;
            font-weight: 600;
            cursor: pointer;
            box-shadow: 0 2px 8px rgba(44, 62, 80, 0.08);
            transition: background 0.2s, transform 0.2s;
            margin-bottom: 8px;
        }
        #start:hover {
            background: linear-gradient(90deg, #388e3c 60%, #66bb6a 100%);
            transform: scale(1.04);
        }
        #wpm-live {
            margin-top: 10px;
            font-weight: bold;
            color: #388e3c;
            text-align: center;
            font-size: 1.08em;
        }
        ul {
            padding-left: 18px;
        }
        /* Responsive */
        @media (max-width: 768px) {
            body {
                margin: 20px auto;
                padding: 0 10px;
            }
            .main-box {
                padding: 20px 16px;
                margin-top: 15px;
            }
            h1 {
                font-size: 1.6em;
                margin-bottom: 12px;
                letter-spacing: 0.5px;
            }
            #timer {
                font-size: 0.95em;
                margin-bottom: 8px;
            }
            #texte {
                font-size: 0.95em;
                padding: 10px 8px;
                min-height: 40px;
                line-height: 1.6;
                margin: 15px 0;
                max-height: 30vh;
                overflow-y: auto;
            }
            input[type="text"] {
                font-size: 16px;
                padding: 10px 8px;
                margin-bottom: 8px;
            }
            #start {
                width: 100%;
                padding: 12px;
                font-size: 1em;
            }
            #start:active {
                transform: scale(0.98);
            }
            #progress {
                font-size: 0.9em;
            }
            #progress-bar {
                height: 8px;
                margin-top: 8px;
            }
            #wpm-live {
                font-size: 0.95em;
            }
            #result {
                padding: 12px 10px;
                font-size: 0.9em;
            }
            .reaction-box {
                max-width: 100%;
                padding: 20px 16px;
                margin: 20px auto 0 auto;
            }
            .reaction-box h2 {
                font-size: 1.15em;
                margin-bottom: 15px;
            }
            #reaction-area {
                height: 100px;
                font-size: 1em;
            }
            #reaction-message {
                padding: 0 10px;
                text-align: center;
            }
        }
        
        @media (max-width: 480px) {
            body {
                margin: 10px auto;
                padding: 0 5px;
            }
            .main-box {
                padding: 15px 12px 12px 12px;
                margin-top: 10px;
            }
            h1 {
                font-size: 1.35em;
                margin-bottom: 10px;
            }
            #timer {
                font-size: 0.9em;
            }
            #texte {
                font-size: 0.85em;
                padding: 8px 6px;
                line-height: 1.5;
                margin: 12px 0;
                max-height: 25vh;
            }
            input[type="text"] {
                font-size: 16px;
                padding: 8px 6px;
            }
            #start {
                padding: 10px;
                font-size: 0.95em;
            }
            #result {
                font-size: 0.85em;
                padding: 10px 8px;
            }
            #result ul {
                padding-left: 12px;
                margin: 5px 0;
            }
            #result li {
                margin: 4px 0;
            }
            .reaction-box {
                padding: 15px 12px;
                margin: 15px auto 0 auto;
            }
            .reaction-box h2 {
                font-size: 1em;
                margin-bottom: 12px;
            }
            #reaction-area {
                height: 80px;
                font-size: 0.9em;
            }
            #reaction-result {
                font-size: 0.95em;
            }
            #reaction-stats {
                font-size: 0.85em;
            }
        }
        .reaction-box {
            background: #fff;
            border-radius: 18px;
            box-shadow: 0 8px 32px rgba(44,62,80,0.12);
            padding: 28px 24px 24px 24px;
            margin: 40px auto 0 auto;
            max-width: 500px;
            text-align: center;
        }
        .reaction-box h2 {
            margin-top: 0;
            color: #2d3a4a;
            font-size: 1.3em;
            margin-bottom: 18px;
        }
        #reaction-area {
            display: flex;
            align-items: center;
            justify-content: center;
            height: 120px;
            background: #f7fafd;
            border-radius: 12px;
            margin-bottom: 18px;
            font-size: 1.2em;
            cursor: pointer;
            outline: none;
            border: 2px solid #b6c7d6;
            transition: background 0.2s, border 0.2s;
            user-select: none;
        }
        #reaction-area.waiting {
            background: #ffe4b2;
            border-color: #ff9800;
        }
        #reaction-area.green {
            background: #d4ffd4;
            border-color: #4caf50;
        }
        #reaction-area.success {
            background: #b2ffd4;
            border-color: #388e3c;
        }
        #reaction-area.error {
            background: #ffb2b2;
            border-color: #a00;
        }
        #reaction-message {
            font-weight: 600;
            color: #2d3a4a;
        }
        #reaction-result {
            font-size: 1.08em;
            margin-top: 8px;
        }
    </style>
</head>
<body>
    <div class="main-box">
        <h1>Test de vitesse d'écriture</h1>
        <div id="timer">Temps restant : 60s</div>
        <div id="texte"></div>
        <input type="text" id="input" disabled autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" style="width:100%;font-size:1em;">
        <button id="start">Commencer</button>
        <div id="progress"></div>
        <div id="progress-bar"><div id="progress-bar-inner"></div></div>
        <div id="wpm-live" style="margin-top:10px;font-weight:bold;"></div>
        <div id="result"></div>
    </div>
    <div class="reaction-box">
        <h2>Test de vitesse de réaction</h2>
        <div id="reaction-area" tabindex="0">
            <span id="reaction-message">Cliquez ici ou appuyez sur Espace pour commencer</span>
        </div>
        <div id="reaction-result"></div>
        <div id="reaction-stats"></div>
    </div>
    <script>
        // Liste de phrases pour générer un texte aléatoire
        const phrases = [
            "Le soleil brille aujourd'hui et les oiseaux chantent dans le jardin.",
            "J'aime apprendre de nouvelles choses chaque jour, car cela me permet de grandir et de m'améliorer.",
            "Il est important de boire de l'eau et de prendre soin de sa santé.",
            "Les enfants jouent dans le parc pendant que les adultes discutent sur les bancs.",
            "La voiture roule vite sur la route, mais il faut toujours rester prudent.",
            "Le livre est posé sur la table, attendant d'être lu.",
            "Nous allons au marché ce matin pour acheter des fruits et des légumes frais.",
            "Le vent souffle fort ce soir, apportant une fraîcheur bienvenue après une journée chaude.",
            "Elle prépare un gâteau au chocolat pour le dessert, et toute la famille se réjouit de le goûter.",
            "Le chien court après la balle dans le jardin.",
            "La pluie tombe doucement sur les fenêtres.",
            "Le professeur explique la leçon aux élèves attentifs.",
            "Un avion passe dans le ciel bleu.",
            "Le repas est servi sur la grande table familiale.",
            "Les fleurs colorent le parc au printemps.",
            "Le train arrive à la gare à l'heure prévue.",
            "La musique résonne dans toute la maison.",
            "Le film commence dans quelques minutes.",
            "Les montagnes sont couvertes de neige en hiver.",
            "Le café sent bon le matin."
        ];

        let texte = "";
        let temps = 60, timer, enCours = false, timerStarted = false;
        let position = 0, erreurs = 0, motsCorrects = 0, caracteresCorrects = 0;
        let saisieTotale = ""; // stocke toute la saisie
        let lastAnimatedWord = null;

        const timerDiv = document.getElementById('timer');
        const texteDiv = document.getElementById('texte');
        const input = document.getElementById('input');
        const startBtn = document.getElementById('start');
        const resultDiv = document.getElementById('result');
        const progressDiv = document.getElementById('progress');

        function genererTexte() {
            // Mélange les phrases et en prend 6 à 8 pour créer un texte unique
            let shuffled = phrases.slice().sort(() => Math.random() - 0.5);
            let count = 6 + Math.floor(Math.random() * 3); // 6 à 8 phrases
            return shuffled.slice(0, count).join(" ");
        }

        function afficherTexte() {
            // Découpe le texte en mots
            const mots = texte.split(' ');
            let html = '';
            let pos = 0;
            let saisiePos = 0;
            for (let i = 0; i < mots.length; i++) {
                let mot = mots[i];
                let motLen = mot.length;
                let classe = 'word';
                let motSaisi = saisieTotale.slice(saisiePos, saisiePos + motLen);
                let wordHtml = '';
                for (let j = 0; j < motLen; j++) {
                    let globalPos = saisiePos + j;
                    if (globalPos === position) {
                        // Caractère courant
                        wordHtml += `<span class="current-char">${mot[j]}</span>`;
                    } else {
                        wordHtml += mot[j];
                    }
                }
                // Ajoute l'espace après le mot
                let espaceHtml = ' ';
                if (saisiePos + motLen === position) {
                    // Si le caractère courant est un espace
                    espaceHtml = `<span class="current-char"> </span>`;
                }
                if (i < positionMot()) {
                    if (motSaisi === mot) {
                        classe += ' done';
                        // Ajoute l'animation si c'est le dernier mot validé
                        if (lastAnimatedWord === i) {
                            classe += ' word-animate';
                        }
                    } else {
                        classe += ' error';
                    }
                } else if (i === positionMot()) {
                    if (motSaisi && motSaisi !== mot.slice(0, motSaisi.length)) {
                        classe += ' error current';
                    } else {
                        classe += ' current';
                    }
                }
                html += `<span class="${classe}" data-word-index="${i}">${wordHtml}</span>${espaceHtml}`;
                saisiePos += motLen + 1;
                pos += motLen + 1;
            }
            texteDiv.innerHTML = html.trim();

            // Auto-scroll pour garder le mot courant centré
            const currentEl = texteDiv.querySelector('.word.current');
            if (currentEl) {
                const containerHeight = texteDiv.clientHeight;
                const elTop = currentEl.offsetTop;
                const elHeight = currentEl.clientHeight;
                
                // Centre le mot courant verticalement
                texteDiv.scrollTop = elTop - containerHeight / 2 + elHeight / 2;
            }

            // Retire l'animation après 300ms
            if (lastAnimatedWord !== null) {
                setTimeout(() => {
                    const el = texteDiv.querySelector(`[data-word-index="${lastAnimatedWord}"]`);
                    if (el) el.classList.remove('word-animate');
                    lastAnimatedWord = null;
                }, 300);
            }
        }

        function positionMot() {
            // Retourne l'indice du mot courant
            return texte.slice(0, position).split(' ').length - 1;
        }

        function updateProgressBar() {
            const percent = Math.min(100, Math.round((position / texte.length) * 100));
            document.getElementById('progress-bar-inner').style.width = percent + '%';
        }

        function updateWPM() {
            let elapsed = 60 - temps;
            let mots = saisieTotale.split(/\s+/).filter(Boolean).length;
            let wpm = elapsed > 0 ? Math.round(mots * 60 / elapsed) : 0;
            document.getElementById('wpm-live').textContent = `Vitesse actuelle : ${wpm} mots/minute`;
        }

        function demarrerTest() {
            enCours = true;
            temps = 60;
            position = 0;
            erreurs = 0;
            motsCorrects = 0;
            caracteresCorrects = 0;
            saisieTotale = "";
            timerStarted = false;
            texte = genererTexte();
            resultDiv.textContent = '';
            input.value = '';
            input.disabled = false;
            startBtn.disabled = true;
            afficherTexte();
            progressDiv.textContent = `Progression : 0/${texte.length} caractères`;
            timerDiv.textContent = "Temps restant : 60s";
            document.getElementById('wpm-live').textContent = '';
            input.focus();
            updateProgressBar();
        }

        function lancerTimer() {
            timerStarted = true;
            timer = setInterval(() => {
                temps--;
                timerDiv.textContent = `Temps restant : ${temps}s`;
                updateWPM();
                if (temps <= 0) {
                    finirTest();
                }
            }, 1000);
        }

        function finirTest() {
            enCours = false;
            clearInterval(timer);
            input.disabled = true;
            startBtn.disabled = false;
            let motsTotal = saisieTotale.split(/\s+/).filter(Boolean).length;
            let totalSaisis = caracteresCorrects + erreurs;
            let precision = totalSaisis ? Math.round((caracteresCorrects / totalSaisis) * 100) : 0;

            // Affiche le texte saisi avec erreurs en rouge
            let affichage = "";
            let erreursList = [];
            for (let i = 0; i < saisieTotale.length; i++) { // <-- correction ici
                if (saisieTotale[i] !== texte[i]) {
                    affichage += `<span class="error">${saisieTotale[i] || ""}</span>`;
                    erreursList.push(
                        `Position ${i + 1}: attendu "<b>${texte[i] || " "}</b>", saisi "<b>${saisieTotale[i] || " "}</b>"`
                    );
                } else {
                    affichage += `<span class="done">${saisieTotale[i] || ""}</span>`;
                }
            }

            // Texte original pour comparaison
            let texteOriginal = "";
            for (let i = 0; i < texte.length; i++) {
                texteOriginal += `<span>${texte[i]}</span>`;
            }

            resultDiv.innerHTML = `<b>Résultats :</b><br>
                Vitesse : ${motsTotal} mots/minute<br>
                Précision : ${precision}%<br>
                Erreurs : ${erreurs}<br>
                <b>Votre saisie :</b><br>${affichage}<br><br>
                <b>Texte original :</b><br>${texteOriginal}<br><br>`;
            texteDiv.innerHTML = '';
            progressDiv.textContent = '';
            document.getElementById('wpm-live').textContent = '';
            document.getElementById('progress-bar-inner').style.width = '0';
        }

        input.addEventListener('input', function() {
            if (!enCours) return;
            if (!timerStarted && input.value.length > 0) {
                lancerTimer();
            }
            let saisi = input.value;
            let correct = true;
            for (let i = 0; i < saisi.length; i++) {
                let attendu = texte[position];
                if (saisi[i] === attendu) {
                    caracteresCorrects++;
                    saisieTotale += saisi[i];
                    position++;
                    // Animation si on termine un mot (sur espace ou fin du texte)
                    if (attendu === ' ' || position === texte.length) {
                        lastAnimatedWord = positionMot() - 1;
                    }
                } else {
                    correct = false;
                    erreurs++;
                    // Effet visuel d'erreur
                    input.classList.add('error-blink');
                    setTimeout(() => input.classList.remove('error-blink'), 200);
                    break; // Stoppe la saisie dès la première erreur
                }
            }
            // Compte les mots corrects (mots sans erreur)
            let mots = saisi.split(/\s+/).filter(Boolean).length;
            motsCorrects += mots;
            input.value = '';
            afficherTexte();
            progressDiv.textContent = `Progression : ${position}/${texte.length} caractères`;
            updateWPM();
            updateProgressBar();
            if (position >= texte.length) {
                finirTest();
            }
        });

        startBtn.addEventListener('click', demarrerTest);

        // --- Test de vitesse de réaction ---
        const reactionArea = document.getElementById('reaction-area');
        const reactionMessage = document.getElementById('reaction-message');
        const reactionResult = document.getElementById('reaction-result');
        const reactionStats = document.getElementById('reaction-stats');
        let reactionState = 'ready'; // ready | waiting | green | done
        let reactionTimeout = null;
        let reactionStartTime = null;
        let reactionTimes = [];

        function startReactionTest() {
            reactionResult.textContent = '';
            reactionMessage.textContent = 'Préparez-vous...';
            reactionArea.className = 'waiting';
            reactionState = 'waiting';
            // Délai aléatoire entre 1 et 3 secondes
            const delay = 1000 + Math.random() * 2000;
            reactionTimeout = setTimeout(() => {
                reactionArea.className = 'green';
                reactionMessage.textContent = 'Cliquez ou appuyez sur Espace !';
                reactionStartTime = performance.now();
                reactionState = 'green';
            }, delay);
        }

        function resetReactionTest() {
            clearTimeout(reactionTimeout);
            reactionArea.className = '';
            reactionMessage.textContent = 'Cliquez ici ou appuyez sur Espace pour commencer';
            reactionState = 'ready';
            reactionStartTime = null;
        }

        function showReactionStats() {
            if (reactionTimes.length === 0) {
                reactionStats.textContent = '';
                return;
            }
            const last = reactionTimes[reactionTimes.length - 1];
            const avg5 = reactionTimes.slice(-5).reduce((a, b) => a + b, 0) / Math.min(5, reactionTimes.length);
            const avg10 = reactionTimes.slice(-10).reduce((a, b) => a + b, 0) / Math.min(10, reactionTimes.length);
            reactionStats.innerHTML =
                `<div style="margin-top:10px;">
                    <b>Dernier temps :</b> <span style="color:#388e3c;">${last.toFixed(0)} ms</span><br>
                    <b>Moyenne sur 5 :</b> <span style="color:#388e3c;">${avg5.toFixed(0)} ms</span><br>
                    <b>Moyenne sur 10 :</b> <span style="color:#388e3c;">${avg10.toFixed(0)} ms</span>
                </div>`;
        }

        function handleReaction(e) {
            if (reactionState === 'ready') {
                startReactionTest();
            } else if (reactionState === 'waiting') {
                clearTimeout(reactionTimeout);
                reactionArea.className = 'error';
                reactionMessage.textContent = 'Trop tôt ! Réessayez.';
                reactionResult.textContent = '';
                reactionState = 'done';
            } else if (reactionState === 'green') {
                const reactionTime = performance.now() - reactionStartTime;
                reactionArea.className = 'success';
                reactionMessage.textContent = 'Bravo !';
                reactionResult.innerHTML = `<b>Temps de réaction :</b> <span style="color:#388e3c;font-size:1.2em;">${reactionTime.toFixed(0)} ms</span>`;
                reactionTimes.push(reactionTime);
                showReactionStats();
                reactionState = 'done';
            } else if (reactionState === 'done') {
                // Relance automatiquement le test
                startReactionTest();
            }
        }

        reactionArea.addEventListener('click', handleReaction);
        reactionArea.addEventListener('keydown', function(e) {
            if (e.code === 'Space' || e.key === ' ') {
                handleReaction();
            }
        });

        resetReactionTest();

        // Optionnel : focus automatique pour la zone de réaction sur mobile
        reactionArea.addEventListener('touchstart', () => reactionArea.focus());

    </script>
</body>
</html>
